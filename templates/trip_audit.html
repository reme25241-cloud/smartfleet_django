<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>{{ title|default:"Smart Fleet Ai" }}</title>
</head>

<body style="background:#0D1117; color:white; font-family:Arial; padding:20px">
  <h1>Trip Auditor Dashboard</h1>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 my-6">
    <div class="bg-[#161B22] p-4 rounded"><h2 class="text-sm text-gray-400">Total Trips Generated</h2><p class="text-2xl">{{ total_trips }}</p></div>
    <div class="bg-[#161B22] p-4 rounded"><h2 class="text-sm text-gray-400">Trips Opened vs Audited</h2><p class="text-2xl">{{ opened }} / {{ audited }}</p></div>
    <div class="bg-[#161B22] p-4 rounded"><h2 class="text-sm text-gray-400">Trips Closed vs Audited</h2><p class="text-2xl">{{ closed }} / {{ audit_closed }}</p></div>
    <div class="bg-[#161B22] p-4 rounded"><h2 class="text-sm text-gray-400">Flags</h2><p class="text-2xl">{{ flags }}</p></div>
  </div>
  <div class="bg-[#161B22] p-4 rounded">
    <canvas id="tripChart"></canvas>
  </div>
  <script>
    const ctx = document.getElementById('tripChart').getContext('2d');
    new Chart(ctx, {
      data: { labels: Array.from({length:31}, (_,i)=>`Day ${i+1}`),
        datasets:[
          { type:'bar', label:'Closed Trips', data: {{ closed_data|safe }} },
          { type:'bar', label:'Audited Trips', data: {{ audited_data|safe }} },
          { type:'line', label:'Audit %', data: {{ audit_pct|safe }}, yAxisID:'y1', borderColor:'lime', borderWidth:2, fill:false, tension:0.3 }
        ]
      },
      options:{ responsive:true, scales:{ y:{beginAtZero:true}, y1:{beginAtZero:true, position:'right', grid:{drawOnChartArea:false}}} }
    });
  </script>
  <div class="bg-[#161B22] p-4 rounded mt-6">
    <h2>Trips</h2>
    <table class="w-full"><thead><tr><th class="text-left p-2">Trip ID</th><th class="text-left p-2">Actions</th></tr></thead>
      <tbody>
      {% for t in trips %}
        <tr><td class="p-2">{{ t."trip id" }}</td><td class="p-2"><a class="bg-blue-600 px-3 py-1 rounded" href="{% url 'audit_trip' t.'trip id' %}">Audit</a></td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</body></html>
